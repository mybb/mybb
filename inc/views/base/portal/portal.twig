{% extends 'layouts/master.twig' %}

{% block head %}
    <title>{{ mybb.settings.bbname }}</title>
    <link rel="alternate" type="application/rss+xml" title="{{ lang.latest_announcements }} (RSS 2.0)" href="{{ mybb.settings.bburl }}/syndication.php?portal=1" />
    <link rel="alternate" type="application/atom+xml" title="{{ lang.latest_announcements }} (Atom 1.0)" href="{{ mybb.settings.bburl }}/syndication.php?portal=1&amp;type=atom1.0" />
{% endblock head %}

{% block body %}
    <div class="page-content page-content--sidebar">
        {% for announcement in announcements %}
            {% include 'portal/portal_announcement.twig' %}
        {% endfor %}
        {{ multipage|raw }}
    </div>
    <div class="page-sidebar">
        {% if mybb.settings.portal_showwelcome %}
            <section class="block block--sidebar">
                <h2 class="title title--sidebar">{{ lang.welcome }}</h2>
                        {% if mybb.user.uid %}
                            <ul class="list list--divided list--stats">
                                <li class="list__item">{{ lang.member_welcome_lastvisit }} {{ portal.lastvisit|raw }}
                                <li class="list__item">{{ lang.new_announcements }}</li>
                                <li class="list__item">{{ lang.new_threads }}</li>
                                <li class="list__item">{{ lang.new_posts }}</li>
                            </ul>
                        {% else %}
                            <span class="smalltext">{{ lang.guest_welcome_registration|raw }}</span><br />
                            <br />
                            <form method="post" action="{{ mybb.settings.bburl }}/member.php">
                                <input type="hidden" name="action" value="do_login" />
                                <input type="hidden" name="url" value="{{ portal.portal_url }}" />
                                {{ portal.username }}<br />&nbsp;&nbsp;<input type="text" class="textbox" name="username" value="" /><br /><br />
                                {{ lang.password }}<br />&nbsp;&nbsp;<input type="password" class="textbox" name="password" value="" /><br /><br />
                                <label title="{{ lang.remember_me_desc }}"><input type="checkbox" class="checkbox" name="remember" value="yes" /> {{ lang.remember_me }}</label><br /><br />
                                <br /><input type="submit" class="button" name="loginsubmit" value="{{ lang.login }}" />
                            </form>
                        {% endif %}
                    </td>
                </tr>
            </section>
        {% endif %}
        {% if portal.showpms %}
            <section class="block block--sidebar">
                <h2 class="title title--sidebar"><a href="{{ mybb.settings.bburl }}/private.php">{{ lang.private_messages }}</a></h2>
                <ul class="list list--divided list--stats">
                    <li class="list__item">
                        <span class="list__field">{{ lang.pms_unread }}</span>
                        <span class="list__value">{{ portal.pms_unread }}</span>
                    </li>
                    <li class="list__item">
                        <span class="list__field">{{ lang.pms_total }}</span>
                        <span class="list__value">{{ portal.pms_total }}</span>
                    </li>
                </ul>
            </section>
        {% endif %}
        {# TO DO: Remove portal "show search" setting (there's a quick search on every page already #}
        {% if mybb.settings.portal_showstats %}
            <section class="block block--sidebar">
                <h2 class="title title--sidebar"><a href="{{ mybb.settings.bburl }}/stats.php">{{ lang.forum_stats }}</a></h2>
                <ul class="list list--divided list--stats">
                    <li class="list__item">
                        <span class="list__field">{{ lang.num_members }}</span>
                        <span class="list__value">{{ portal.numusers }}</span>
                    </li>
                    <li class="list__item">
                        <span class="list__field">{{ lang.latest_member }}</span>
                        <span class="list__value">{{ portal.newestmember|raw }}</span>
                    </li>
                    <li class="list__item">
                        <span class="list__field">{{ lang.num_threads }}</span>
                        <span class="list__value">{{ portal.numthreads }}</span>
                    </li>
                    <li class="list__item">
                        <span class="list__field">{{ lang.num_posts }}</span>
                        <span class="list__value">{{ portal.numposts }}</span>
                    </li>
                </ul>
            </section>
        {% endif %}
        {% if mybb.settings.portal_showwol and mybb.usergroup.canviewonline %}
            <section class="block block--sidebar">
                <h2 class="title title--sidebar"><a href="{{ mybb.settings.bburl }}/online.php">{{ lang.online }}</a></h2>
                <ul class="list list--divided list--stats">
                    <li class="list__item">{{ lang.online_users|raw }} ({{ lang.online_counts|raw }})</li>
                    <li class="list__item">
                        {% for online in onlinemembers %}
                            {% if online.isbot %}
                                {{ online.username }}{% if not loop.last %}{{ lang.comma }}{% endif %}
                            {% else %}
                                <a href="{{ mybb.settings.bburl }}/{{ online.profilelink|raw }}">{{ online.username|raw }}</a>{{ online.invisiblemark }}{% if not loop.last %}{{ lang.comma }}{% endif %}
                            {% endif %}
                        {% endfor %}
                    </li>
                </ul>
            </section>
        {% endif %}
        {% if portal.latestthreads %}
            <section class="block block--sidebar">
                <h2 class="title title--sidebar">{{ lang.latest_threads }}</h2>
                <ul class="list list--divided latest-threads">
                    {% for thread in threadlist %}
                        <li class="list__item latest-threads__item">
                            <h4 class="latest-threads__title"><a href="{{ mybb.settings.bburl }}/{{ thread.threadlink }}" title="{{ thread.fullsubject }}">{{ thread.subject }}</a></h4>
                            <p class="latest-threads__forum">{{ lang.forum }} <a href="{{ thread.forumlink }}">{{ thread.forumname }}</a></p>
                            <p class="latest-threads__last-post">{{ lang.latest_threads_lastpost }} <span class="latest-threads__author">{{ thread.lastposterlink|raw }}</span> <a href="{{ thread.lastpostlink|raw }}" class="latest-threads__date">{{ thread.lastpostdate|raw }}</a></p>
                            <p class="latest-threads__stats">
                                <span class="latest-threads__stat">
                                    {{ thread.replies }} {% if thread.replies == 1 %}{{ lang.latest_threads_reply }}{% else %}{{ lang.latest_threads_replies }}{% endif %}
                                </span>
                                &middot;
                                <span class="latest-threads__stat">
                                    {{ thread.views }} {% if thread.views == 1 %}{{ lang.latest_threads_view }}{% else %}{{ lang.latest_threads_views }}{% endif %}
                                </span>
                            </p>
                        </li>
                    {% endfor %}
                </ul>
            </section>
        {% endif %}
    </div>
{% endblock body %}
